{"componentChunkName":"component---src-pages-docs-mdx-slug-js","path":"/docs/guides/migrating-to-v2-api","result":{"data":{"mdx":{"slug":"guides/migrating-to-v2-api","frontmatter":{"title":"迁移到 Jotai v2 API","description":"New \"Async\" API"},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"迁移到 Jotai v2 API\",\n  \"description\": \"New \\\"Async\\\" API\",\n  \"nav\": 3.13\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"RFC: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/pmndrs/jotai/discussions/1514\"\n  }, \"https://github.com/pmndrs/jotai/discussions/1514\")), mdx(\"p\", null, \"Jotai v1 \\u4E8E 2022 \\u5E74 6 \\u6708\\u53D1\\u5E03\\uFF0C\\u6536\\u5230\\u4E86\\u5404\\u79CD\\u53CD\\u9988\\u3002\\nReact \\u8FD8\\u63D0\\u51FA\\u4E86\\u5BF9 promise \\u7684\\u652F\\u6301\\u3002\\nJotai v2 \\u5C06\\u6709\\u4E00\\u4E2A\\u65B0\\u7684 API\\u3002\"), mdx(\"p\", null, \"\\u4E0D\\u5E78\\u7684\\u662F\\uFF0C\\u968F\\u7740\\u65B0\\u529F\\u80FD\\u7684\\u51FA\\u73B0\\uFF0C\\u6709\\u4E00\\u4E9B\\u91CD\\u5927\\u53D8\\u5316\\u3002\"), mdx(\"h2\", null, \"\\u4EC0\\u4E48\\u662F\\u65B0\\u529F\\u80FD\"), mdx(\"h3\", null, \"Vanilla \\u5E93\"), mdx(\"p\", null, \"Jotai \\u5206\\u522B\\u5E26\\u6709 vanilla\\uFF08\\u975E React\\uFF09\\u51FD\\u6570\\u548C React \\u51FD\\u6570\\u3002\"), mdx(\"h3\", null, \"Store API\"), mdx(\"p\", null, \"Jotai \\u66B4\\u9732\\u4E86\\u5B58\\u50A8\\u63A5\\u53E3\\uFF0C\\u4EE5\\u4FBF\\u60A8\\u53EF\\u4EE5\\u76F4\\u63A5\\u64CD\\u4F5C\\u539F\\u5B50\\u503C\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"import { createStore } from \\\"jotai/vanilla\\\";\\n\\nconst store = createStore();\\nstore.set(fooAtom, \\\"foo\\\");\\n\")), mdx(\"p\", null, \"\\u60A8\\u8FD8\\u53EF\\u4EE5\\u521B\\u5EFA\\u81EA\\u5DF1\\u7684 React \\u4E0A\\u4E0B\\u6587\\u6765\\u4F20\\u9012 store\\u3002\"), mdx(\"h3\", null, \"\\u66F4\\u7075\\u6D3B\\u7684\\u539F\\u5B50\", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"write\"), \"\\u51FD\\u6570\"), mdx(\"p\", null, \"write \\u51FD\\u6570\\u53EF\\u4EE5\\u63A5\\u53D7\\u591A\\u4E2A\\u53C2\\u6570\\uFF0C\\u5E76\\u8FD4\\u56DE\\u4E00\\u4E2A\\u503C\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"atom(\\n  (get) => get(...),\\n  (get, set, arg1, arg2, ...) => {\\n    ...\\n    return someValue\\n  }\\n)\\n\")), mdx(\"h2\", null, \"\\u4EC0\\u4E48\\u4E1C\\u897F\\u574F\\u4E86\"), mdx(\"h3\", null, \"Import \\u58F0\\u660E\"), mdx(\"p\", null, \"\\u65B0\\u7684 API \\u4ECE\\u4E0D\\u540C\\u7684\\u5165\\u53E3\\u70B9\\u63D0\\u4F9B\\uFF1A\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"jotai/vanilla\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"jotai/vanilla/utils\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"jotai/react\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"jotai/react/devtools\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"jotai/react/utils\"))), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"import { atom } from \\\"jotai/vanilla\\\";\\nimport { useAtom } from \\\"jotai/react\\\";\\n\")), mdx(\"p\", null, \"\\u8FD9\\u4E9B\\u65B0\\u7684\\u5165\\u53E3\\u70B9\\u4F5C\\u4E3A\\u9884\\u53D1\\u5E03\\u7248\\u672C\\u6DFB\\u52A0\\u5230 v1.11.0 \\u4E2D\\uFF0C\\u5C06\\u5728 v2.0.0 \\u53D1\\u5E03\\u540E\\u7EE7\\u7EED\\u5DE5\\u4F5C\\u3002\"), mdx(\"p\", null, \"\\u5728 v2.0.0 \\u4E2D\\uFF0C\\u5B83\\u4EEC\\u662F\\u9ED8\\u8BA4\\u503C\\uFF0C\\u65E7\\u5165\\u53E3\\u70B9\\u4EC5\\u5F15\\u7528\\u65B0\\u5165\\u53E3\\u70B9\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"// v2\\nimport { atom } from \\\"jotai\\\"; // \\u4E0E'jotai/vanilla'\\u76F8\\u540C\\nimport { useAtom } from \\\"jotai\\\"; // \\u4E0E 'jotai/react' \\u76F8\\u540C\\n\")), mdx(\"h3\", null, \"\\u5F02\\u6B65\\u539F\\u5B50\\u4E0D\\u518D\\u7279\\u6B8A\"), mdx(\"p\", null, \"\\u5F02\\u6B65\\u539F\\u5B50\\u53EA\\u662F\\u5177\\u6709 promise \\u503C\\u7684\\u666E\\u901A\\u539F\\u5B50\\u3002\\n\\u539F\\u5B50 getter \\u51FD\\u6570\\u4E0D\\u89E3\\u6790 promise\\u3002\\n\\u53E6\\u4E00\\u65B9\\u9762\\uFF0C\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useAtom\"), \" hook \\u7EE7\\u7EED\\u89E3\\u6790 promise\\u3002\"), mdx(\"h3\", null, \"\\u53EF\\u5199\\u539F\\u5B50\\u7C7B\\u578B\\u5DF2\\u66F4\\u6539\\uFF08\\u4EC5\\u9650 TypeScript\\uFF09\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"// \\u65E7\\nWritableAtom<Value, Arg, Result extends void | Promise<void>>\\n\\n// \\u65B0\\nWritableAtom<Value, Args extends unknown[], Result>\\n\")), mdx(\"p\", null, \"\\u4E00\\u822C\\u6765\\u8BF4\\uFF0C\\u6211\\u4EEC\\u5E94\\u8BE5\\u907F\\u514D\\u76F4\\u63A5\\u4F7F\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"WritableAtom\"), \" \\u7C7B\\u578B\\u3002\"), mdx(\"h3\", null, \"\\u4E00\\u4E9B\\u529F\\u80FD\\u88AB\\u5220\\u9664\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Provider \\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"initialValues\"), \" \\u5C5E\\u6027\\u88AB\\u79FB\\u9664\\uFF0C\\u56E0\\u4E3A \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"store\"), \" \\u66F4\\u7075\\u6D3B\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Provider \\u7684\\u8303\\u56F4\\u5C5E\\u6027\\u88AB\\u5220\\u9664\\uFF0C\\u56E0\\u4E3A\\u60A8\\u53EF\\u4EE5\\u521B\\u5EFA\\u81EA\\u5DF1\\u7684\\u4E0A\\u4E0B\\u6587\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"abortableAtom\"), \" \\u5DE5\\u5177\\u88AB\\u5220\\u9664\\uFF0C\\u56E0\\u4E3A\\u9ED8\\u8BA4\\u5305\\u542B\\u8BE5\\u529F\\u80FD\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"waitForAll\"), \" \\u5DE5\\u5177\\u88AB\\u5220\\u9664\\uFF0C\\u56E0\\u4E3A \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Promise.all\"), \" \\u53EF\\u4EE5\\u6B63\\u5E38\\u5DE5\\u4F5C\")), mdx(\"h2\", null, \"\\u8FC1\\u79FB\\u6307\\u5357\"), mdx(\"h3\", null, \"\\u5F02\\u6B65\\u539F\\u5B50\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get\"), \"\\u51FD\\u6570\\u7528\\u4E8E\\u5F02\\u6B65\\u539F\\u5B50\\u7684\\u8BFB\\u53D6\\u51FD\\u6570\\u4E0D\\u89E3\\u6790 promise\\uFF0C\\u6240\\u4EE5\\u4F60\\u5FC5\\u987B\\u653E \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"await\"), \"\\u3002\"), mdx(\"p\", null, \"\\u7B80\\u800C\\u8A00\\u4E4B\\uFF0C\\u66F4\\u6539\\u5982\\u4E0B\\u6240\\u793A\\u3002\\n\\uFF08\\u5982\\u679C\\u60A8\\u662F TypeScript \\u7528\\u6237\\uFF0C\\u7C7B\\u578B\\u4F1A\\u544A\\u8BC9\\u60A8\\u5728\\u54EA\\u91CC\\u66F4\\u6539\\u3002\\uFF09\"), mdx(\"h4\", null, \"\\u4EE5\\u524D\\u7684 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const asyncAtom = atom(async () => \\\"hello\\\");\\nconst derivedAtom = atom((get) => get(asyncAtom).toUppercase());\\n\")), mdx(\"h4\", null, \"\\u65B0 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const asyncAtom = atom(async () => \\\"hello\\\");\\nconst derivedAtom = atom(async (get) => (await get(asyncAtom)).toUppercase());\\n\")), mdx(\"h3\", null, \"Provider \\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"initialValues\"), \" \\u5C5E\\u6027\"), mdx(\"h4\", null, \"Previous API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"const countAtom = atom(0)\\n\\n  <Provider initialValues={[[countAtom, 1]]}>\\n    ...\\n  </Provider>\\n\")), mdx(\"h4\", null, \"\\u65B0 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"const countAtom = atom(0)\\nconst store = createStore()\\nstore.set(countAtom, 1)\\n\\n  <Provider store={store}>\\n    ...\\n  </Provider>\\n\")), mdx(\"h3\", null, \"Provider \\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"scope\"), \" \\u5C5E\\u6027\"), mdx(\"h4\", null, \"\\u65E7 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"const myScope = Symbol()\\n\\n  // \\u7236\\u7EC4\\u4EF6\\n  <Provider scope={myScope}>\\n    ...\\n  </Provider>\\n\\n  // \\u5B50\\u7EC4\\u4EF6\\n  useAtom(..., myScope)\\n\")), mdx(\"h4\", null, \"\\u65B0 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"const MyContext = createContext()\\nconst store = createStore()\\n\\n  // \\u7236\\u7EC4\\u4EF6\\n  <MyContext.Provider value={store}>\\n    ...\\n  </MyContext.Provider>\\n\\n  // \\u5B50\\u7EC4\\u4EF6\\n  const store = useContext(MyContext)\\n  useAtom(..., { store })\\n\")), mdx(\"h3\", null, mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"abortableAtom\"), \" util\"), mdx(\"p\", null, \"\\u60A8\\u4E0D\\u518D\\u9700\\u8981\\u4EE5\\u524D\\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"abortableAtom\"), \" utils\\uFF0C\\u56E0\\u4E3A\\u73B0\\u5728\\u666E\\u901A\\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"atom\"), \" \\u652F\\u6301\\u5B83\\u3002\"), mdx(\"h4\", null, \"\\u65E7 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const asyncAtom = abortableAtom(async (get, { signal }) => {\\n ...\\n}\\n\")), mdx(\"h4\", null, \"\\u65B0 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const asyncAtom = atom(async (get, { signal }) => {\\n  ...\\n}\\n\")), mdx(\"h3\", null, mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"waitForAll\"), \" util\"), mdx(\"p\", null, \"\\u60A8\\u4E0D\\u518D\\u9700\\u8981\\u4EE5\\u524D\\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"waitForAll\"), \" \\u5DE5\\u5177\\uFF0C\\u56E0\\u4E3A\\u6211\\u4EEC\\u53EF\\u4EE5\\u4F7F\\u7528\\u539F\\u751F\\u7684 Promise API\\u3002\"), mdx(\"h4\", null, \"\\u65E7 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const allAtom = waitForAll([fooAtom, barAtom]);\\n\")), mdx(\"h4\", null, \"\\u65B0 API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const allAtom = atom((get) => Promise.all([get(fooAtom), get(barAtom)]));\\n\")), mdx(\"h2\", null, \"\\u4E00\\u4E9B\\u5176\\u5B83\\u6539\\u53D8\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"atomWithStorage\"), \" util \\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"delayInit\"), \" \\u4F5C\\u4E3A\\u9ED8\\u8BA4\\u503C\\u88AB\\u5220\\u9664\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"useHydrateAtoms\"), \" \\u53EA\\u80FD\\u63A5\\u53D7\\u53EF\\u5199\\u539F\\u5B50\\u3002\")));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"3e1baddc-1f05-530b-98a1-17d9addb4d45","slug":"guides/migrating-to-v2-api","__params":{"slug":"guides"}}},"staticQueryHashes":["171421096","4167841181","930225796"]}